(function(){var k=function(){$lib=AtKit.lib();AtKit.addLocalisationMap("en",{tts_title:"Text to Speech",tts_options:"Text to Speech Options",tts_what:"What do you want to convert to speech?",tts_selected:"Selected Text",tts_page:"Entire Page",tts_converting:"Text to Speech conversion is taking place.",tts_timeremaining:"Time Remaining:",tts_pleasewait:"Please wait...",tts_playpause:"Play / Pause",tts_rewind:"Rewind",tts_stop:"Stop & Close TTS",tts_error:"Error",tts_overloaded:"The server is currently over capacity for text to speech conversions. Please try again later.",
tts_problem:"Something went wrong while we were converting this page to speech. Please try again shortly.",tts_servererror:"An error occurred on the server. Please try again later.",tts_seconds:"seconds",tts_explain:"To use the text to speech feature with selected text, please first select the text on this page that you would like to convert. After you have done this, click the Text to Speech button, and select the 'selected text' option."});AtKit.addLocalisationMap("ar",{tts_title:"&#1578;&#1581;&#1608;&#1612;&#1604; &#1575;&#1604;&#1606;&#1589; &#1575;&#1604;&#1593;&#1585;&#1576;&#1611; &#1621;&#1575;&#1604;&#1609; &#1603;&#1575;&#1604;&#1605;",
tts_options:"&#1582;&#1610;&#1575;&#1585;&#1575;&#1578; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;",tts_what:"&#1605;&#1575; &#1607;&#1608; &#1575;&#1604;&#1606;&#1589; &#1575;&#1604;&#1584;&#1610; &#1578;&#1585;&#1610;&#1583; &#1606;&#1591;&#1602;&#1607",tts_selected:"&#1575;&#1604;&#1606;&#1589; &#1575;&#1604;&#1605;&#1581;&#1583;&#1583;",tts_page:"&#1603;&#1575;&#1605;&#1604; &#1575;&#1604;&#1589;&#1601;&#1581;&#1577;",tts_converting:"&#1580;&#1575;&#1585;&#1610;&#1577; &#1581;&#1575;&#1604;&#1610;&#1575;&#1611; &#1593;&#1605;&#1604;&#1610;&#1577; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;",
tts_timeremaining:"&#1575;&#1604;&#1608;&#1602;&#1578; &#1575;&#1604;&#1605;&#1578;&#1576;&#1602;&#1610;",tts_pleasewait:"&#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1575;&#1604;&#1575;&#1606;&#1578;&#1592;&#1575;&#1585;...",tts_playpause:"&#1578;&#1588;&#1594;&#1610;&#1604;/&#1573;&#1610;&#1602;&#1575;&#1601; &#1605;&#1572;&#1602;&#1578;",tts_rewind:"&#1573;&#1593;&#1575;&#1583;&#1577;",tts_stop:"&#1573;&#1610;&#1602;&#1575;&#1601;",tts_error:"&#1582;&#1591;&#1571;",tts_overloaded:"&#1601;&#1575;&#1602;&#1578; &#1593;&#1605;&#1604;&#1610;&#1575;&#1578; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;&#1608;&#1589; &#1587;&#1593;&#1577; &#1575;&#1604;&#1582;&#1575;&#1583;&#1605;. &#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1575;&#1604;&#1605;&#1581;&#1575;&#1608;&#1604;&#1577; &#1604;&#1575;&#1581;&#1602;&#1575;&#1611;.",
tts_problem:"&#1581;&#1583;&#1579; &#1582;&#1591;&#1571; &#1571;&#1579;&#1606;&#1575;&#1569; &#1593;&#1605;&#1604;&#1610;&#1577; &#1606;&#1591;&#1602; &#1575;&#1604;&#1589;&#1601;&#1581;&#1577;. &#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1575;&#1604;&#1605;&#1581;&#1575;&#1608;&#1604;&#1577; &#1576;&#1593;&#1583; &#1602;&#1604;&#1610;&#1604;.",tts_servererror:"&#1581;&#1583;&#1579; &#1582;&#1591;&#1571; &#1601;&#1610; &#1575;&#1604;&#1582;&#1575;&#1583;&#1605;. &#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1575;&#1604;&#1605;&#1581;&#1575;&#1608;&#1604;&#1577; &#1604;&#1575;&#1581;&#1602;&#1575;&#1611;.",
tts_seconds:"&#1579;&#1608;&#1575;&#1606;&#1613;",tts_explain:"&#1604;&#1575;&#1587;&#1578;&#1582;&#1583;&#1575;&#1605; &#1582;&#1575;&#1589;&#1610;&#1577; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;&#1548; &#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1578;&#1581;&#1583;&#1610;&#1583; &#1575;&#1604;&#1606;&#1589; &#1575;&#1604;&#1605;&#1585;&#1575;&#1583; &#1578;&#1581;&#1608;&#1610;&#1604;&#1607; &#1593;&#1604;&#1609; &#1607;&#1584;&#1607; &#1575;&#1604;&#1589;&#1601;&#1581;&#1577;. &#1576;&#1593;&#1583; &#1584;&#1604;&#1603; &#1575;&#1590;&#1594;&#1591; &#1586;&#1585; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;&#1548; &#1608;&#1575;&#1590;&#1594;&#1591; &#1582;&#1610;&#1575;&#1585; &quot;&#1575;&#1604;&#1606;&#1589; &#1575;&#1604;&#1605;&#1581;&#1583;&#1583;&quot;."});
var g={options:{title:"Text to Speech options",body:'What do you want to convert to speech? <br /><button id="sbStartTTS"> Entire page</button> <button id="sbStartTTSSelection"> Selected text</button>'},starting:{title:"Text To Speech",body:"<center>Text to Speech conversion is taking place. <br /><img src='"+AtKit.getPluginURL()+"images/loadingbig.gif' /><br />Time remaining: <div id='sbttstimeremaining'>calculating</div><br />Please wait... </center>"}},f={clickEnabled:!0,positition:"",playingItem:"",
TTSButtons:{ttsPlay:{tooltip:"Play / Pause",icon:AtKit.getPluginURL()+"images/control-pause.png",fn:function(){("msie"==$lib.browser?swfobject.getObjectById(AtKit.get("ATAudioPlayerID")):window.document.audioe).sendEvent("play")}},ttsRewind:{tooltip:"Rewind",icon:AtKit.getPluginURL()+"images/control-stop-180.png",fn:function(){var a=AtKit.get("TTS_position")-2;0>a&&(a=0);("msie"==$lib.browser?swfobject.getObjectById(AtKit.get("ATAudioPlayerID")):window.document.audioe).sendEvent("seek",a)}},ttsStop:{tooltip:"Stop & Close TTS",
icon:AtKit.getPluginURL()+"images/control-stop-square.png",fn:function(){("msie"==$lib.browser?swfobject.getObjectById(AtKit.get("ATAudioPlayerID")):window.document.audioe).sendEvent("stop");AtKit.call("TTSRemoveControlBox")}}}};AtKit.addFn("getSelectedText",function(a){var c="";window.getSelection?c=window.getSelection():document.getSelection?c=document.getSelection():document.selection&&(c=document.selection.createRange().text);return!0==a?String(c).replace(/([\s]+)/ig,""):String(c)});AtKit.addFn("b64",
function(a){for(var c="",d,e,f,g,j,h,i=0,a=AtKit.call("utf8_encode",a);i<a.length;)d=a.charCodeAt(i++),e=a.charCodeAt(i++),f=a.charCodeAt(i++),g=d>>2,d=(d&3)<<4|e>>4,j=(e&15)<<2|f>>6,h=f&63,isNaN(e)?j=h=64:isNaN(f)&&(h=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(j)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(h);
return c});AtKit.addFn("utf8_encode",function(a){for(var a=a.replace(/\r\n/g,"\n"),c="",d=0;d<a.length;d++){var e=a.charCodeAt(d);128>e?c+=String.fromCharCode(e):(127<e&&2048>e?c+=String.fromCharCode(e>>6|192):(c+=String.fromCharCode(e>>12|224),c+=String.fromCharCode(e>>6&63|128)),c+=String.fromCharCode(e&63|128))}return c});AtKit.addFn("sendTTSChunk",function(a){var c=1==a.block?0:800*a.block,c=a.fullData.substring(c,c+800>a.fullData.length?a.fullData.length:c+800),c="https://speech.services.atbar.org/tts/request.php?rt=tts&v=2&id="+
a.reqID+"&data="+c+"&chunkData="+a.totalBlocks+"-"+a.block;a.block==a.totalBlocks-1&&(c+="&page="+encodeURIComponent(window.location));$lib.getJSON(c+"&callback=?",function(c){$lib("#compactStatus").html(a.block+" / "+a.totalBlocks);a.block==a.totalBlocks?(AtKit.show(g.starting),"encoding"==c.status?AtKit.call("countdownTTS",{timeLeft:c.est_completion/c.chunks,id:c.ID}):"failure"==c.status&&"overcapacity"==c.reason?AtKit.message("<h2>Oops!</h2><p>The server is currently over capacity for text to speech conversions. Please try again later.</p>"):
"failure"==c.status&&""==c.message?AtKit.message("<h2>Oops!</h2><p>Something went wrong while we were converting this page to text. Please try again shortly.</p>"):AtKit.message("<h2>Oops!</h2><p>"+c.reason+" "+c.data.message+"</p>")):"ChunkSaved"==c.data.message?AtKit.call("sendTTSChunk",{fullData:a.fullData,block:a.block+1,totalBlocks:a.totalBlocks,reqID:a.reqID}):AtKit.message("<h2>Error</h2><p>An error occurred on the server. Please try again later.</p>")})});AtKit.addFn("countdownTTS",function(a){isNaN(a.timeLeft)?
AtKit.message("<h2>Oops!</h2> <p>Something went wrong while we were converting this page to text (received a NaN for timeLeft).</p>"):0==a.timeLeft?("msie"!=$lib.browser?($lib("body").append($lib('<div id="flashContent"><OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" width="1" height="1" id="audioe"> <PARAM name=movie value="https://speech.services.atbar.org/lib/player/player-licensed.swf"></PARAM> <PARAM name=flashvars value="file=https://speech.services.atbar.org/cache/'+
a.id+'.xml&autostart=true&playlist=bottom&repeat=list&playerready=playerReady&id=audioo"><PARAM name=allowscriptaccess value="always" /><embed type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="https://speech.services.atbar.org/lib/player/player-licensed.swf" width="1" height="1" allowscriptaccess="always" allowfullscreen="false" flashvars="file=https://speech.services.atbar.org/cache/'+a.id+'.xml&autostart=true&playlist=bottom&repeat=list&playerready=playerReady" name="audioe" /> </OBJECT></div>')),
AtKit.call("setupTTSListeners")):($lib("<div />",{id:"flashContent"}).prependTo("body"),swfobject.embedSWF("https://speech.services.atbar.org/player/player-licensed.swf","flashContent","1","1","9.0.0","expressInstall.swf",!1,{flashvars:"file=https://speech.services.atbar.org/cache/"+a.id+".xml&autostart=true&playlist=bottom&repeat=list&playerready=playerReady&id=audioo",allowscriptaccess:"always"},{id:"audioo",name:"audioo"},function(){AtKit.call("setupTTSListeners")})),AtKit.hideDialog()):($lib("#sbttstimeremaining").html(a.timeLeft+
" seconds"),window.setTimeout(function(){AtKit.call("countdownTTS",{timeLeft:a.timeLeft-1,id:a.id})},1E3))});AtKit.addFn("setupTTSListeners",function(){!0!=AtKit.get("TTS_Listeners_setup")&&(window.playerReady=function(a){AtKit.set("ATAudioPlayerID",a.id);for(b in f.TTSButtons)a=f.TTSButtons[b],AtKit.addButton(b,a.tooltip,a.icon,a.fn);AtKit.set("TTS_position",0);AtKit.set("TTS_playingItem",0);a=swfobject.getObjectById(a.id);"msie"!=$lib.browser&&(a=window.document.audioe);a.addModelListener("STATE",
"ATBarAudioStateListener");a.addModelListener("TIME","ATBarAudioTimeMonitor");a.addControllerListener("ITEM","ATBarAudioItemMonitor")},window.ATBarAudioTimeMonitor=function(a){AtKit.set("TTS_position",a.position)},window.ATBarAudioItemMonitor=function(a){AtKit.set("TTS_playingItem",a.index)},window.ATBarAudioStateListener=function(a){var c=a.newstate,a=swfobject.getObjectById(a.id);"msie"!=$lib.browser&&(a=window.document.audioe);"COMPLETED"==c&&AtKit.get("TTS_playingItem")+1==a.getPlaylist().length&&
AtKit.call("TTSRemoveControlBox");"IDLE"==c||"PAUSED"==c?($lib("#at-lnk-ttsPlay").children("img").attr("src",AtKit.getPluginURL()+"images/control.png"),$lib("#at-btn-tts").children("img").attr("src",AtKit.getPluginURL()+"images/sound.png").css("padding-top","6px")):!1==AtKit.get("TTS_clickEnabled")&&($lib("#at-lnk-ttsPlay").children("img").attr("src",AtKit.getPluginURL()+"images/control-pause.png"),$lib("#at-btn-tts").children("img").attr("src",AtKit.getPluginURL()+"images/loading.gif").css("padding-top",
"8px"))},AtKit.set("TTS_Listeners_setup",!0))});AtKit.addFn("TTSRemoveControlBox",function(){AtKit.removeButton("ttsPlay");AtKit.removeButton("ttsRewind");AtKit.removeButton("ttsStop");$lib("#flashContent").remove();$lib("#at-lnk-tts").children("img").attr("src",AtKit.getPluginURL()+"images/sound.png").css("padding-top","6px");AtKit.set("TTS_clickEnabled",!0)});AtKit.set("TTS_clickEnabled",!0);AtKit.addButton("tts","Text to Speech",AtKit.getPluginURL()+"images/sound.png",function(a){!1!=AtKit.set("TTS_clickEnabled")&&
(AtKit.show(a.options),AtKit.set("TTS_Listeners_setup",!1),AtKit.addScript("https://core.atbar.org/resources/js/swfobject.js",null),$lib("#sbStartTTS").click(function(){var a=$lib(document.body).clone();a.find("script, noscript, style, #facebox_overlay, #sbar, #sbarGhost, #facebox, br, img").remove();a=String(a.html()).replace(/<\!---.*---\>/g,"");a.replace(/[\n\r]+/g,"");console.log(a);var a=AtKit.call("b64",a),d=Math.ceil(a.length/800);if(0<d){var e=Math.floor(5001*Math.random());AtKit.message("<h2>Processing</h2><p>Compacting and transmitting data...<br /><div id='compactStatus'>0 / "+
d+"</div></p>");AtKit.call("sendTTSChunk",{fullData:a,block:1,totalBlocks:d,reqID:e})}else AtKit.message("<h2>Oops!</h2><p>There doesn't seem to be any content on this page, or we can't read it.</p>")}),$lib("#sbStartTTSSelection").click(function(){AtKit.set("TTS_clickEnabled",!1);var a=AtKit.call("getSelectedText");if(""!=a){this.clickEnabled=!1;var a=AtKit.call("b64",a),d=Math.ceil(a.length/800);if(0<d){var e=Math.floor(5001*Math.random());AtKit.message("<h2>Processing</h2><p>Compacting and transmitting data...<br /><div id='compactStatus'>0 / "+
d+"</div></p>");AtKit.call("sendTTSChunk",{fullData:a,block:1,totalBlocks:d,reqID:e})}else AtKit.message("<h2>Oops!</h2><p>There doesn't seem to be any content on this page, or we can't read it.</p>")}else AtKit.message("<h2>Text-to-Speech</h2><p>To use the text to speech feature with selected text, please first select the text on this page that you would like to convert. After you have done this, click the Text to Speech button, and select the 'selected text' option.</p>")}))},g,{},f);$lib("a#at-lnk-tts").hover(function(){console.log("test");
AtKit.call("getSelectedText")})};"undefined"==typeof window.AtKit?(window.AtKitLoaded=function(){var g=null;this.subscribe=function(f){g=f};this.fire=function(f,a){null!=g&&g(f,a)}},window.AtKitLoaded=new AtKitLoaded,window.AtKitLoaded.subscribe(function(){AtKit.registerPlugin("tts",k)})):AtKit.registerPlugin("tts",k)})();
